{
  "version": "1.0.0",
  "tasks": [
    {
      "id": "add-rate-limiting",
      "prompt": "Add rate limiting to the API endpoints to prevent abuse",
      "category": "add-feature",
      "difficulty": "medium",
      "expectedGrounding": {
        "relevantFiles": [
          {
            "file": "src/middleware/auth.ts",
            "relevance": "pattern-example",
            "importance": "important",
            "sectionsOfInterest": [
              { "startLine": 1, "endLine": 50, "description": "Shows middleware pattern to follow" }
            ]
          },
          {
            "file": "src/routes/index.ts",
            "relevance": "modify",
            "importance": "critical"
          },
          {
            "file": "src/config/index.ts",
            "relevance": "modify",
            "importance": "important"
          },
          {
            "file": "package.json",
            "relevance": "modify",
            "importance": "helpful"
          }
        ],
        "relevantPatterns": [
          {
            "patternId": "auth-jwt-middleware",
            "relevance": "Shows how middleware is structured and applied to routes",
            "action": "follow"
          },
          {
            "patternId": "config-env-pattern",
            "relevance": "Rate limit config should follow same pattern",
            "action": "follow"
          }
        ],
        "constraints": [
          {
            "type": "must-use-pattern",
            "description": "Rate limiter must be Express middleware following existing middleware pattern",
            "severity": "error",
            "source": "codebase-pattern"
          },
          {
            "type": "requires-error-handling",
            "description": "Must return proper 429 response with Retry-After header",
            "severity": "error",
            "source": "explicit-rule"
          }
        ],
        "similarCode": [
          {
            "file": "src/middleware/auth.ts",
            "startLine": 15,
            "endLine": 45,
            "description": "Auth middleware shows the exact pattern for request middleware",
            "similarity": "exact-pattern"
          }
        ],
        "doNotModify": [
          {
            "file": "src/middleware/auth.ts",
            "reason": "Auth middleware is stable and well-tested",
            "consequence": "Could break authentication for all protected routes"
          }
        ],
        "relevantTests": [
          "src/__tests__/middleware.test.ts"
        ],
        "estimatedScope": {
          "filesToModify": 3,
          "filesToCreate": 1,
          "complexity": "moderate"
        }
      },
      "testsFocus": [
        "file-discovery",
        "pattern-matching",
        "constraint-awareness",
        "similar-code-finding"
      ]
    },
    {
      "id": "add-user-soft-delete",
      "prompt": "Add soft delete functionality to users instead of hard delete",
      "category": "refactor",
      "difficulty": "easy",
      "expectedGrounding": {
        "relevantFiles": [
          {
            "file": "src/services/userService.ts",
            "relevance": "modify",
            "importance": "critical"
          },
          {
            "file": "src/controllers/userController.ts",
            "relevance": "modify",
            "importance": "critical"
          },
          {
            "file": "prisma/schema.prisma",
            "relevance": "modify",
            "importance": "critical"
          },
          {
            "file": "src/services/productService.ts",
            "relevance": "pattern-example",
            "importance": "helpful"
          }
        ],
        "relevantPatterns": [
          {
            "patternId": "data-access-prisma",
            "relevance": "Shows how Prisma queries are structured",
            "action": "extend"
          }
        ],
        "constraints": [
          {
            "type": "backwards-compatible",
            "description": "Existing API responses should not change shape",
            "severity": "error",
            "source": "compatibility"
          },
          {
            "type": "requires-test",
            "description": "Must add tests for soft delete behavior",
            "severity": "warning",
            "source": "codebase-pattern"
          }
        ],
        "similarCode": [
          {
            "file": "src/services/userService.ts",
            "startLine": 28,
            "endLine": 35,
            "description": "Current delete implementation to modify",
            "similarity": "similar-structure"
          }
        ],
        "doNotModify": [],
        "relevantTests": [
          "src/__tests__/userService.test.ts",
          "src/__tests__/userController.test.ts"
        ],
        "estimatedScope": {
          "filesToModify": 3,
          "filesToCreate": 0,
          "complexity": "simple"
        }
      },
      "testsFocus": [
        "file-discovery",
        "scope-estimation",
        "test-awareness"
      ]
    },
    {
      "id": "fix-auth-bypass",
      "prompt": "There's a security issue where the /admin endpoint can be accessed without authentication. Fix it.",
      "category": "security-fix",
      "difficulty": "easy",
      "expectedGrounding": {
        "relevantFiles": [
          {
            "file": "src/routes/admin.ts",
            "relevance": "modify",
            "importance": "critical"
          },
          {
            "file": "src/middleware/auth.ts",
            "relevance": "dependency",
            "importance": "important"
          },
          {
            "file": "src/routes/index.ts",
            "relevance": "context",
            "importance": "helpful"
          }
        ],
        "relevantPatterns": [
          {
            "patternId": "auth-jwt-middleware",
            "relevance": "This middleware must be applied to admin routes",
            "action": "follow"
          }
        ],
        "constraints": [
          {
            "type": "requires-auth",
            "description": "All admin routes must use auth middleware",
            "severity": "blocker",
            "source": "security"
          }
        ],
        "similarCode": [
          {
            "file": "src/routes/users.ts",
            "startLine": 5,
            "endLine": 15,
            "description": "Shows how auth middleware is correctly applied to protected routes",
            "similarity": "exact-pattern"
          }
        ],
        "doNotModify": [
          {
            "file": "src/middleware/auth.ts",
            "reason": "Auth middleware is correct, the issue is in route configuration",
            "consequence": "Could break auth for all routes"
          }
        ],
        "relevantTests": [
          "src/__tests__/admin.test.ts"
        ],
        "estimatedScope": {
          "filesToModify": 1,
          "filesToCreate": 0,
          "complexity": "trivial"
        }
      },
      "testsFocus": [
        "file-discovery",
        "constraint-awareness",
        "negative-knowledge"
      ]
    }
  ]
}
